<!DOCTYPE html><html nighteye="disabled"><head><meta charset="utf8"><script src="node_modules/reveal.js/dist/reveal.js"></script><script src="node_modules/reveal.js/plugin/math/math.js"></script><script src="node_modules/reveal.js-plugins/chalkboard/plugin.js"></script><script src="node_modules/@svgdotjs/svg.js/dist/svg.min.js"></script><script src="node_modules/svgtiler/lib/svgtiler.js"></script><script src="node_modules/reveal.js/plugin/highlight/highlight.js"></script><link rel="stylesheet" href="node_modules/reveal.js/plugin/highlight/monokai.css"><link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css"><link rel="stylesheet" href="node_modules/reveal.js/dist/theme/black.css"><link rel="stylesheet" href="node_modules/reveal.js-plugins/chalkboard/style.css"><link rel="stylesheet" href="node_modules/reveal.js-plugins/menu/font-awesome/css/all.css"><link rel="stylesheet" href="node_modules/@fontsource/merriweather/latin-400.css"><link rel="stylesheet" href="node_modules/@fontsource/merriweather/latin-400-italic.css"><link rel="stylesheet" href="node_modules/@fontsource/merriweather/latin-900.css"><link rel="stylesheet" href="node_modules/@fontsource/merriweather/latin-900-italic.css"><style>:root {
  --r-main-font: Merriweather, serif;
  --r-heading-font: Merriweather, serif;
  --r-heading-text-transform: none;
  --r-background-color: #000;
  --r-selection-background-color: #444;
}
.reveal .slides section .fragment {
  opacity: 0;
  visibility: hidden;
  transition: all 1s ease;
  will-change: initial;
}
.reveal .slides section .fragment.visible {
  opacity: 1;
  visibility: inherit;
}
ul,
ol {
  width: calc(100% - 1em);
  box-sizing: border-box;
}
th {
  color: #000;
  background: #ccc;
  border-color: #000;
}
cite {
  color: #c0a5c0;
  font-weight: normal;
}
h2 cite {
  font-size: 85%;
}
.columns {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-evenly;
}
.column {
  text-align: center !important;
  max-height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.column.fill {
  flex-basis: 0;
  flex-grow: 1;
  align-self: stretch;
}
.column.space {
  width: 30px;
}
.column.arrow {
  margin: 0 10px;
  font-size: 200%;
}
.column.arrow:before {
  content: 'ğŸ¡†';
}
.text-center {
  text-align: center !important;
}
.vertical-middle {
  vertical-align: middle !important;
}
.d-inline-block {
  display: inline-block;
}
.justify-content-center {
  justify-content: center;
}
.justify-content-between {
  justify-content: space-between;
}
.h-100 {
  height: 100%;
}
.ml-1,
span.space {
  margin-left: 0.25em;
}
.ml-2 {
  margin-left: 0.5em;
}
.hidden {
  position: absolute;
  display: block;
}
.invert {
  filter: invert(1) hue-rotate(180deg);
}
.invert.pop {
  filter: invert(1) hue-rotate(180deg) drop-shadow(0 0 1px #fff);
}
.invert.pop.bright {
  filter: invert(1) hue-rotate(180deg) brightness(1.75) drop-shadow(0 0 1px #fff);
}
.full {
  margin: 0;
  max-width: 100%;
  max-height: 100%;
}
.url {
  display: block;
  font-size: 40%;
  font-family: monospace;
}
.sep {
  display: inline-block;
  color: #9a5b9a;
  margin: 0 0.25em;
}
</style></head><body><div class="reveal"><div class="slides"><section><h1 style="font-variant: small-caps">å¦‚ä½•ç”¨goå†™parser</h1><hr><h4>acekingke<span class="sep">&bull;</span><u>æŸ¯ç…œæ˜Œ</u><span class="sep">&bull;</span>https://github.com/acekingke</h4><hr><p>å†…å®¹ç®€ä»‹</p><ul> <li>ç¼–è¯‘åŸç†å›é¡¾<ul><li>å½¢å¼æ–‡æ³•åŸºç¡€</li><li>LR,LALRåˆ†æå™¨</li></ul></li><li>Yacc </li><li>è¯­æ³•åˆ†æå™¨ demo</li></ul></section><section> <h2>ä»€ä¹ˆæ˜¯parser</h2><div class="columns"> <div class="column"><h3>string</h3><div class="pre">1+2*61</div></div><div class="column">$\to$</div><div class="column"><h3>expr</h3><pre>   E
 / | \
E  +  E
|    /|\
i   E * E 
    |   |
    i   i</pre></div></div><p class="fragment">$ç¨‹åºè¯­è¨€$è®©äººå’Œæœºå™¨éƒ½èƒ½çœ‹æ‡‚..., </p><p class="fragment">parser èƒ½è®©æœºå™¨çœ‹æ‡‚ç¨‹åºè¯­è¨€</p></section><section> <h2>åº”ç”¨åœºæ™¯</h2><ul> <li>ç¨‹åºè¯­è¨€ç¼–è¯‘å™¨ã€é¢†åŸŸä¸“ç”¨è¯­è¨€</li><li>æ–‡ä»¶æ ¼å¼è§£æ(é€šå¸¸)</li><li>ç½‘ç»œåè®®è§£æ</li></ul></section><section><h2>å½¢å¼æ–‡æ³•åŸºç¡€1</h2><ul>   <li>è¯­è¨€&å¥æ³• <br><span class="fragment">$G = \langle V, N, P, S \rangle $ </span><span class="fragment"> G æ˜¯è¯­æ³•çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªå››å…ƒç»„ï¼Œå…¶ä¸­ï¼š</span><li class="fragment"> V æ˜¯ä¸€ä¸ªé›†åˆï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰çš„ç»ˆç»“ç¬¦</li><li class="fragment">N æ˜¯ä¸€ä¸ªé›†åˆï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰çš„éç»ˆç»“ç¬¦</li><li class="fragment"> P æ˜¯ä¸€ä¸ªé›†åˆï¼ŒåŒ…å«æ‰€æœ‰äº§ç”Ÿå¼è§„åˆ™</li><li class="fragment"> S éç»ˆç»“ç¬¦,å³å¼€å§‹ç¬¦å·</li></li></ul></section><section><h2>å½¢å¼æ–‡æ³•åŸºç¡€2</h2><p class="fragment">ç¤ºä¾‹ï¼š(è¡¨è¾¾å¼)
<br>
$
E \to i \\
E \to E + E \\
E \to E * E \\
E \to ( E ) \\
$ 
<br></p><cite>å¤§å†™å­—æ¯è¡¨ç¤ºéç»ˆç»“ç¬¦, å°å†™å­—æ¯a,b,c,t... æ˜¯ç»ˆç»“ç¬¦
å¸Œè…Šå­—æ¯æ˜¯å­—ç¬¦ä¸²,åŒ…å«ç»ˆç»“ç¬¦å’Œéç»ˆç»“ç¬¦
x,y,z æ˜¯ç»ˆç»“ç¬¦ä¸²
</cite><!-- li.fragment Math is easy: $\displaystyle \sum_{i=1}^n i^2$--></section><section class="data-auto-animate"><h2>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• </h2><p>$ \alpha \to \beta $
<br>
$\alpha$ å§‹ç»ˆæ˜¯ä¸€ä¸ªéç»ˆç»“ç¬¦
<br>
å½¢å¦‚:$aA \to ab$ å°±ä¸æ˜¯ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• <br>
å½¢å¦‚:
<br>
$  
A \to aB \\
B \to b 
$
<br>
å°±æ˜¯ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• <br></p></section><section class="data-auto-animate"><h2>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• </h2><p>$  
A \to aB \\
B \to b 
$
<br>
å°±æ˜¯ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³• <br></p><p class="fragment" fade-out data-fragment-index="0"> <strong>æ¨å¯¼:</strong>ç”±$A \to aB å’Œ B \to b $ ç”Ÿæˆå­—ç¬¦ä¸²$ab$ <br>è‡ªé¡¶å‘ä¸‹, å‘å·¦æ¨å¯¼, LLåˆ†æå™¨, ANTLR </p><p class="fragment" fade-out data-fragment-index="1"><strong>è§„çº¦:</strong>ç”±$ab$ ç”Ÿæˆ$aB,$ç”Ÿæˆ$A$ <br>è‡ªåº•å‘ä¸Š, å‘å³è§„çº¦, LR, YACC </p></section><section><h2>æœ‰é™è‡ªåŠ¨æœº</h2><div class="columns">  <p class="column">ç¤ºä¾‹(LR(0) åˆ†æå™¨):
<br>
  $ S \to E \\
  E \to aEb \\
  E \to ab
  $</p><p class="column"><img src="images/dfa.png"></p></div></section><section><h2>åˆ†æè¡¨</h2><p>$s_n$ è¡¨ç¤ºç§»è¿›åˆ°çŠ¶æ€n 
<br>
$r_k$ è¡¨ç¤ºæŒ‰ç…§è§„åˆ™ k è§„çº¦</p><div class="columns"><div class="column"><span>LR åˆ†æå™¨ç»“æ„</span><img src="images/lrpaser.png"></div><div class="column"><span>åŠ¨ä½œè¡¨æ ¼</span><img src="images/acttap.png"></div><div class="column"> <span>å †æ ˆç¤ºä¾‹</span><img src="images/stack.png"></div></div></section><section class="data-auto-animate"><h2>LR(0) æ”¹è¿›</h2><p>æ— æ³•åˆ†æå¦‚ä¸‹è¯­æ³•ï¼š<br>
 $
  L \to D; \\
  D \to t V \\
  V \to i \\
  V \to i,V
 $ <br>
 D ä¸ºç±»å‹å£°æ˜, V ä¸ºå˜é‡, tä¸ºç±»å‹, iä¸ºæ ‡è¯†ç¬¦</p><pre> <code class="lang-c"><script type="text/template">int x
int x,y </script></code></pre><p>è§£æåˆ°  int x $\bullet$,y åº”è¯¥è§„çº¦è¿˜æ˜¯åº”è¯¥ç§»è¿›?</p><p class="fragment">éœ€è¦å‘å‰çœ‹ä¸€ä¸ªå­—ç¬¦</p></section><section class="data-auto-animate"><h2>LR(0) æ”¹è¿›</h2><ul><li>ç®€å•LR(SLR, Simple LR parser)</li><li>æ­£ç»ŸLR (Canonical LR parser)</li><li>å‰çœ‹LR(LALR, Look-ahead LR parser)</li></ul><p align="left">yacc/bison é‡‡ç”¨LALR(1)ç”Ÿæˆè§£æå™¨</p><p align="left">LAè¡¨ç¤ºLook Ahead,æ‹¬å·ä¸­1è¡¨ç¤ºå‰çœ‹ç¬¦å·ä¸ªæ•°</p></section><section class="data-auto-animate"><h2>LR(0) æ”¹è¿›</h2><p>LALR(1) ä»ç„¶æ— æ³•è§£å†³è¡¨è¾¾å¼è¯­æ³•:<br>
$ E \to i \\
  E \to E + E \\
  E \to E * E \\
  E \to ( E ) \\
$ <br>
å¦‚ $ E+E\bullet *i \\
   E+ E\bullet + i$ <br>åº”è¯¥è§„çº¦è¿˜æ˜¯åº”è¯¥ç§»è¿›?</p></section><section class="data-auto-animate"><h2>LR(0) æ”¹è¿›</h2><p>é‡‡ç”¨ä¼˜å…ˆçº§, å·¦ç»“åˆ, å³ç»“åˆ</p><p>yacc è¯­æ³•æ˜¯:</p><pre class="fragment"><code class="lang-yacc"><script type="text/template">%left '+'
%left '*'</script></code></pre><p class="fragment">$ E+E\bullet *i  \\
   E+ E\bullet + i \\
åº”è¯¥è§„çº¦è¿˜æ˜¯åº”è¯¥ç§»è¿›? \\
  \text{ * ä¼˜å…ˆçº§é«˜äº+, ç§»è¿›} \\
  \text{ + å·¦ç»“åˆ, è§„çº¦}
$ </p></section><section><h2>yaccgo </h2><p>ç»“æ„</p><pre>                          grammar 
                           rules
                             |
                             v
                        +---------+
                        |  Yacc   |
                        +---------+
                             |
                             v
         +---------+    +---------+
Input -> |  lexer  | -> | yyparse | -> Parsed input
         +---------+    +---------+

                     Yacc </pre></section><section class="data-auto-animate"><h2>lexer </h2><a href="https://talks.golang.org/2011/lex.slide">Rob Pike lexer æ–¹æ³•</a><pre> <code class="lang-go" data-line-numbers="|4-5"><script type="text/template">// run lexes the input by executing state functions
// until the state is nil.
func run() {
    for state := startState; state != nil; {
        state = state(lexer)
    }
}</script></code></pre><cite>Rob Pike è®¤ä¸º, æ­£åˆ™è¡¨è¾¾å¼æ–¹å¼éš¾ä»¥ç†è§£ä¹Ÿéš¾ä»¥è°ƒè¯•, <br>è€Œä½¿ç”¨goè¯­è¨€å®ç°lexerä¸æ˜¯å¾ˆéš¾, <br>ä»¥ä¸Šæ˜¯ä»–ç»™å‡ºä¸€ä¸ªç®€å•çš„lexerå®ç°çš„æ¡†æ¶</cite></section><section class="data-auto-animate"><h2>lexer </h2><a href="https://talks.golang.org/2011/lex.slide">Rob Pike lexer æ–¹æ³•</a><pre> <code class="lang-go" data-line-numbers="3-5|8-10|13-15"><script type="text/template">func lexNumber(l *lexer) stateFn {
  // Optional leading sign.
  l.accept("+-")
  // Is it hex?
  digits := "0123456789"
  if l.accept("0") && l.accept("xX") {
      digits = "0123456789abcdefABCDEF"
  }
  l.acceptRun(digits)
  if l.accept(".") {
      l.acceptRun(digits)
  }
  if l.accept("eE") {
      l.accept("+-")
      l.acceptRun("0123456789")
  }
  // .......
}</script></code></pre></section><section> <h2>yaccgo </h2><p>ç”Ÿæˆè§£æå™¨çš„å·¥å…·</p><p>ç”Ÿæˆparserçš„goä»£ç  </p><div class="columns"> <div class="column">input_file.y</div><div class="column"> $ \to $</div><div class="column">  yaccgo </div><div class="column"> $ \to $</div><div class="column"> parser.go </div></div><p>ç¼–è¯‘ç”Ÿæˆçš„è§£æå™¨</p><div class="columns"><div class="column">  parser.go </div><div class="column"> $ \to $</div><div class="column"> golang compiler</div><div class="column"> $ \to $</div><div class="column">  parser program </div></div><p>è§£æå™¨è¿è¡Œ</p><div class="columns"><div class="column"> input string</div><div class="column"> $ \to $</div><div class="column">  parser program</div><div class="column"> $ \to $</div><div class="column"> output string</div></div></section><section class="data-auto-animate"><h2>yæ–‡ä»¶</h2><p>ç»“æ„</p><pre><code>å£°æ˜éƒ¨åˆ†

%%

è§„åˆ™éƒ¨åˆ†

%%
è¾…åŠ©å‡½æ•°</code></pre></section><section class="data-auto-animate"><h2>yæ–‡ä»¶</h2><p>å£°æ˜éƒ¨åˆ†</p><pre><code>%{
    // åµŒå…¥çš„ go ä»£ç 
%}
// token å£°æ˜, type å£°æ˜, start å£°æ˜, union å£°æ˜</code></pre></section><section class="data-auto-animate"><h2>yæ–‡ä»¶</h2><p>è§„åˆ™éƒ¨åˆ†<pre><code>left part : right part { action }</code></pre></p><p>ä¾‹å¦‚ï¼š</p><pre><code>E:
    E '+' E {
        $$	=	$1 + $3
    }</code></pre><cite> $$ è¡¨ç¤ºleft part å±æ€§å€¼<br>$n è¡¨ç¤ºright part ä¸­çš„ç¬¬nä¸ªç¬¦å·å±æ€§å€¼</cite></section><section> <h2>å…¨è²Œ</h2><pre> <code class="lang-go" data-line-numbers="2-7|9-11|13-20|23-25"><script type="text/template">// language: go
%{
package main
import (
    "fmt"
)
%}

%union {
    val int
}

%type	<val>	E
%token '+'  '*'   '(' ')' 
%left '+'  
%left '*'  
%token	<val>	NUM
%token NUM 100
%start E
%%

E:
    E '+' E {
        $$	=	$1 + $3
    }	
    | E '*' E {
        $$	=	$1 * $3
    }
    | '(' E ')' {
        $$	=	$2
    }
    | NUM {
        $$	=	$1
    }
    
%%
const EOF = -1
// The parser expects the lexer to return 0 on EOF.  Give it a name
// for clarity.
func GetToken(input string, valTy *ValType, pos *int) int {
    if *pos >= len(input) {
        return -1
    } else {
    // ... 
    }</script></code></pre></section><section> <h2>åˆ›å»º</h2><ul><li>åˆ›å»ºä¸€ä¸ªè§£æå™¨<pre> <code class="bash">./bin/yaccgo generate go  examples/expr.y out/expr.go</code></pre></li><li> åˆ›å»ºæºå¸¦webè°ƒè¯•çš„è§£æå™¨<pre> <code class="bash">./bin/yaccgo generate go --httpdebug=true examples/exprhttp.y out/expr.go</code></pre></li><li>æ›´å¤šå‚è§ github.com/acekingke/yaccgo</li></ul></section><section> <h1>æ¼”ç¤ºç¯èŠ‚</h1><h1>Any Question</h1><h1>?</h1></section><section> <h2>å‚è€ƒæ–‡çŒ®</h2><ul> <li> <a href="https://www.seas.upenn.edu/~cis511/notes/cis511-sl9.pdf">upenn.edu </a></li><li><a href="https://zh.m.wikipedia.org/zh-cn/LR%E5%89%96%E6%9E%90%E5%99%A8">wiki</a></li><li> <a href="https://talks.golang.org/2011/lex.slide">Rob Pike lexer æ–¹æ³•</a></li><li><a href="https://github.com/acekingke/yaccgo">github.com/acekingke/yaccgo</a></li></ul></section></div></div><script>(function() {
  Reveal.initialize({
    center: false,
    slideNumber: true,
    hash: true,
    transition: 'none',
    width: 1100,
    height: 768,
    minScale: 0.1,
    maxScale: 10,
    autoAnimateEasing: 'ease-out',
    autoAnimateDuration: 0.8,
    autoAnimateUnmatched: false,
    plugins: [RevealMath.KaTeX, RevealChalkboard, RevealHighlight],
    katex: {
      local: 'node_modules/katex'
    },
    chalkboard: {
      background: ['none', 'node_modules/reveal.js-plugins/chalkboard/img/blackboard.png'],
      boardmarkerWidth: 7,
      colorButtons: true,
      theme: 'whiteboard'
    }
  });

}).call(this);
</script></body></html>